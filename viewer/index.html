<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mini GLB Viewer</title>
  <style>
    html,body{height:100%;margin:0;background:#0b1323;color:#e9ecf5;font:14px/1.45 system-ui,Segoe UI,Inter,Roboto,Arial,sans-serif}
    #stage{position:fixed;inset:0}
    .hud{position:fixed;left:10px;top:10px;background:#0b1220cc;border:1px solid #24314a;border-radius:10px;padding:8px}
    input,button{background:#111828;border:1px solid #24314a;color:#e9ecf5;border-radius:8px;padding:6px 8px}
    .row{display:flex;gap:6px;align-items:center}
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>
<body>
  <div id="stage"></div>
  <div class="hud">
    <div class="row">
      <label>Model-URL:</label>
      <input id="modelUrl" style="width:360px" placeholder="/models/Ground.glb">
      <button id="btnLoad">Load</button>
    </div>
    <div style="margin-top:6px">Tipp: <code>?model=/models/Ground.glb</code></div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

    const stage = document.getElementById('stage');
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    stage.appendChild(renderer.domElement);

    const scene = new THREE.Scene(); scene.background = new THREE.Color('#0b1323');
    const camera = new THREE.PerspectiveCamera(35, innerWidth/innerHeight, 0.01, 2000);
    camera.position.set(2.4,1.2,2.4);
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const hemi = new THREE.HemisphereLight(0xffffff, 0x223344, 1.1); scene.add(hemi);
    const dir  = new THREE.DirectionalLight(0xffffff, 2.2); dir.position.set(2,6,2); scene.add(dir);

    const grid = new THREE.GridHelper(8, 32, 0x5577aa, 0x335077);
    grid.material.transparent = true; grid.material.opacity = 0.25;
    scene.add(grid);

    const gltfLoader = new GLTFLoader();
    const draco = new DRACOLoader();
    draco.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
    gltfLoader.setDRACOLoader(draco);

    let current=null;
    async function loadModel(url){
      try{
        if(current){ scene.remove(current); current.traverse(n=>n.geometry?.dispose?.()); current=null; }
        const gltf = await gltfLoader.loadAsync(url);
        const root = gltf.scene || gltf.scenes?.[0];
        // zentrieren + scale
        const box=new THREE.Box3().setFromObject(root), size=new THREE.Vector3(), center=new THREE.Vector3();
        box.getSize(size); box.getCenter(center);
        root.position.sub(center); // zentrieren
        const maxDim = Math.max(size.x,size.y,size.z) || 1;
        const fit = 1.8; root.scale.setScalar(fit/maxDim);
        current = new THREE.Group(); current.add(root); scene.add(current);
      }catch(e){
        alert('Fehler beim Laden des Modells:\n'+e?.message);
        console.error(e);
      }
    }

    // UI
    const $ = s=>document.querySelector(s);
    $('#btnLoad').onclick = ()=>{ const u=$('#modelUrl').value.trim(); if(u) loadModel(u); };

    // Query-Param
    const qp = new URLSearchParams(location.search);
    const model = qp.get('model') || '/models/Ground.glb';
    $('#modelUrl').value = model;
    loadModel(model);

    // resize
    addEventListener('resize', ()=>{
      renderer.setSize(innerWidth, innerHeight);
      camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix();
    });

    (function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    })();
  </script>
</body>
</html>
